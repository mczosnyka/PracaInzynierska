{% extends "layout.html" %}

{% block styles %}
<style>
    .table-list { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
    .table-list th { background-color: #2c3e50; color: white; padding: 12px; text-align: left; }
    .table-list td { padding: 12px; border-bottom: 1px solid #eee; }
    .table-list tr:hover { background-color: #f1f1f1; }

    .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.85em; font-weight: bold; }
    .status-ok { background-color: #27ae60; color: white; }
    .status-bad { background-color: #95a5a6; color: white; }

    .btn-action { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; text-decoration: none; display: inline-block; color: white; }
    .btn-edit { background-color: #f39c12; }
    .btn-delete { background-color: #c0392b; }
    .btn-add { padding: 10px 20px; background-color: #2980b9; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }

    .form-row { display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap; }
    .input-group { flex: 1; min-width: 150px; }
    .input-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
    .input-group input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

    .alert-box { padding: 15px; margin-bottom: 20px; border-radius: 5px; color: white; }
    .alert-success { background-color: #27ae60; }
    .alert-error { background-color: #c0392b; }
</style>
{% endblock %}

{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert-box {{ 'alert-success' if category == 'success' else 'alert-error' }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px;">âž• Dodaj nowy pojazd</h3>
    <form action="{{ url_for('dodaj_pojazd') }}" method="POST" class="form-row">
        
        <div class="input-group">
            <label>Nr Rejestracyjny:</label>
            <input type="text" name="numer_rejestracyjny" placeholder="np. KR 12345" required>
        </div>

        <div class="input-group">
            <label>PojemnoÅ›Ä‡ (kg/m3):</label>
            <input type="number" step="0.1" name="pojemnosc" placeholder="np. 1500" required>
        </div>

        <div class="input-group">
            <label>Start Lat (N):</label>
            <input type="number" step="any" name="lat" placeholder="50.0614" required>
        </div>

        <div class="input-group">
            <label>Start Lon (E):</label>
            <input type="number" step="any" name="lon" placeholder="19.9366" required>
        </div>

        <div style="padding-bottom: 10px;">
            <input type="checkbox" name="dostepnosc" id="dostepnosc" checked>
            <label for="dostepnosc" style="display:inline; font-weight: bold;">DostÄ™pny</label>
        </div>

        <button type="submit" class="btn-add">Dodaj Pojazd</button>
    </form>
</div>

<div class="card">
    <h3 style="margin-top: 0;">ðŸš› Twoja flota</h3>
    
    {% if pojazdy %}
    <table class="table-list">
        <thead>
            <tr>
                <th>Nr Rejestracyjny</th>
                <th>PojemnoÅ›Ä‡</th>
                <th>Lokalizacja Startowa</th>
                <th>Status</th>
                <th style="text-align: right;">Akcje</th>
            </tr>
        </thead>
        <tbody>
            {% for pojazd in pojazdy %}
            <tr>
                <td><b>{{ pojazd.numer_rejestracyjny }}</b></td>
                <td>{{ pojazd.pojemnosc }} kg</td>
                <td>{{ pojazd.lat }}, {{ pojazd.lon }}</td>
                <td>
                    {% if pojazd.dostepnosc %}
                        <span class="status-badge status-ok">DostÄ™pny</span>
                    {% else %}
                        <span class="status-badge status-bad">ZajÄ™ty/NiedostÄ™pny</span>
                    {% endif %}
                </td>
                <td style="text-align: right;">
                    <a href="{{ url_for('edytuj_pojazd', id_pojazdu=pojazd.id_pojazdu) }}" class="btn-action btn-edit">Edytuj</a>
                    
                    <button type="button" 
                            class="btn-action btn-delete" 
                            onclick="confirmDelete('{{ pojazd.id_pojazdu }}', '{{ pojazd.numer_rejestracyjny }}')">
                        UsuÅ„
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p style="color: gray; padding: 20px; text-align: center;">Brak pojazdÃ³w w bazie. Dodaj pierwszy pojazd powyÅ¼ej.</p>
    {% endif %}
</div>

<script>

function confirmDelete(id, registration) {
    if (confirm(`Czy na pewno chcesz trwale usunÄ…Ä‡ pojazd o numerze ${registration}?`)) {
        
        fetch(`/pojazdy/usun/${id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
                        if (response.ok) {
                window.location.reload(); 
            } else {
                alert("WystÄ…piÅ‚ bÅ‚Ä…d podczas usuwania pojazdu.");
            }
        })
        .catch(error => {
            console.error('BÅ‚Ä…d Fetch:', error);
            alert("BÅ‚Ä…d poÅ‚Ä…czenia z serwerem.");
        });
    }
}
</script>

{% endblock %}